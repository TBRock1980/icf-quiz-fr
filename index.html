<!DOCTYPE html>
<html lang="fr" data-theme="dark">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Quiz ICF ‚Äì Comp√©tences cl√©s (68 questions)</title>
  <link href="https://fonts.googleapis.com/css2?family=Lora:wght@400;500;600;700&family=Montserrat:wght@600;700;800&display=swap" rel="stylesheet">
  <style>
    :root{
      --icf-blue:#30398D; --deep-blue:#001E60; --icf-gold:#FEBD3B; --cred-orange:#EA7600;
      --ok:#16a34a; --bad:#dc2626;
      --font-title:'Montserrat',ui-sans-serif,-apple-system,Segoe UI,Roboto,Helvetica,Arial,sans-serif;
      --font-body:'Lora',ui-serif,Georgia,Cambria,"Times New Roman",Times,serif;
    }
    html,body{height:100%} *{box-sizing:border-box}

    html[data-theme="dark"]{
      --bg1:#001e60; --bg2:#30398D; --bg3:#2c3e83;
      --card:#0b102a; --card2:#12183a; --text:#E7EAF4; --muted:#cfd5ff;
      --accent: var(--cred-orange); --accent2: var(--icf-gold);
      --surface-border: rgba(255,255,255,.12);
      --btn-bg: rgba(255,255,255,.04); --btn-bg-hover: rgba(255,255,255,.08);
      --progress-bg: rgba(255,255,255,.18);
      --chart-grid:#2b2f69; --chart-axis:#9aa3ff; --chart-text:#eef2ff;
    }

    html[data-theme="light"]{
      --bg1:#f3f5ff; --bg2:#ffffff; --bg3:#eef0ff;
      --card:#ffffff; --card2:#f7f8ff; --text:#0f172a; --muted:#334155;
      --accent: var(--icf-blue); --accent2: var(--cred-orange);
      --surface-border: rgba(0,0,0,.10);
      --btn-bg:#ffffff; --btn-bg-hover: rgba(0,0,0,.03);
      --progress-bg: rgba(15,23,42,.12);
      --chart-grid:#dbe1ff; --chart-axis:#4b5563; --chart-text:#111827;
    }

    body{
      margin:0;
      color:var(--text);
      font-family:var(--font-body);
      background-color: var(--bg1);
      background:
        radial-gradient(1200px 600px at 10% -10%, rgba(48,57,141,.25), transparent),
        radial-gradient(1000px 500px at 110% 10%, rgba(254,189,59,.25), transparent),
        linear-gradient(135deg, var(--bg1), var(--bg2) 48%, var(--bg3));
      height:100vh; overflow:hidden;
      display:grid; grid-template-rows:auto 1fr auto;
    }

    header{background:rgba(0,0,0,.18); border-bottom:1px solid var(--surface-border)}
    .wrap{max-width:1100px;margin:0 auto;padding:10px 14px}
    .title{display:flex;align-items:center;justify-content:space-between;gap:10px;flex-wrap:wrap}
    .title h1{margin:0;font-family:var(--font-title);font-weight:800;font-size:clamp(18px,2.6vw,24px)}

    .meter{display:flex;gap:10px;flex-wrap:wrap;align-items:center;justify-content:center;margin-top:6px;font-size:12px}
    .badge{background:linear-gradient(180deg, var(--card2), var(--card));border:1px solid var(--surface-border);padding:6px 8px;border-radius:10px; display:flex; gap:6px; align-items:center}
    .badge b{font-weight:800;color:var(--accent2)}
    .progress{height:8px; flex:1; min-width:160px; border-radius:999px; overflow:hidden; background:var(--progress-bg)}
    .progress>span{display:block;height:100%;width:0%; background:linear-gradient(90deg, var(--accent), var(--accent2)); transition:width .35s ease}

    main{display:grid; place-items:center; padding:8px 10px; overflow:hidden}
    .stage{width:min(900px, 96vw); height:100%; display:flex; align-items:center; justify-content:center}

    .card{
      width:100%; height:min(70vh, 100%); overflow:hidden;
      background:linear-gradient(180deg, var(--card), var(--card2));
      border:1px solid var(--surface-border); border-radius:16px; padding:14px;
      display:grid; grid-template-rows:auto 1fr auto; gap:10px;
      box-shadow: 0 16px 44px rgba(0,0,0,.18);
    }

    .q-head{display:flex; justify-content:space-between; align-items:center; gap:8px; flex-wrap:wrap}
    .q-index{font-size:12px; color:var(--muted); letter-spacing:.2px}
    .question{font-size:clamp(16px,2.2vw,20px);line-height:1.28}

    #options{display:flex;flex-direction:column;gap:8px;}
    .btn{text-align:left; border:1px solid var(--surface-border);background:var(--btn-bg); color:var(--text);
      padding:10px 12px; border-radius:10px; cursor:pointer;font-size:clamp(14px,1.9vw,17px);}
    .btn:hover{transform:translateY(-1px); background:var(--btn-bg-hover)}
    .btn.correct{font-weight:800;border-color:rgba(22,163,74,.6);background:linear-gradient(180deg, rgba(22,163,74,.28), rgba(22,163,74,.14))}
    .btn.wrong{font-weight:800;border-color:rgba(220,38,38,.6);background:linear-gradient(180deg, rgba(220,38,38,.28), rgba(220,38,38,.14))}
    .btn.disabled{pointer-events:none; opacity:.95}

    .pill{font-weight:800; letter-spacing:.2px;background:#fff; padding:6px 8px;border-radius:999px;border:1px solid var(--surface-border); color:#111}
    .nav{display:flex; justify-content:flex-end}
    .action{border:0; padding:10px 16px; border-radius:10px;background:linear-gradient(90deg, var(--accent), var(--accent2)); color:#111827; font-weight:900; cursor:pointer; box-shadow:0 8px 18px rgba(0,0,0,.25)}
    .action.ghost{background:linear-gradient(180deg, var(--card2), var(--card)); border:1px solid var(--surface-border); color:var(--text); box-shadow:none}

    footer{background: rgba(0,0,0,.18); border-top:1px solid var(--surface-border)}
    .footbar{display:flex;align-items:center;justify-content:space-between;gap:12px
      position:relative;
    }

    html[data-theme="dark"] #answered.pill,
    html[data-theme="dark"] footer .pill{
      background: linear-gradient(90deg, var(--accent), var(--accent2));
      color: #111827; border:0; box-shadow: 0 8px 18px rgba(0,0,0,.35);
    }

    #resultModal{display:none}
    #resultModal.show{display:flex; position:fixed; inset:0; align-items:center; justify-content:center;background: rgba(0,0,0,.6); padding:12px;}
    #resultModal .panel{
      max-width:980px; width:92%;
      padding:16px 14px; border-radius:16px;
      background:linear-gradient(180deg, var(--card), var(--card2)); border:1px solid var(--surface-border);
      box-shadow: 0 30px 80px rgba(0,0,0,.5);
      color:var(--text);
      max-height:86vh; overflow:auto;
      display:flex; flex-direction:column; gap:12px;
      text-align:left;
    }
    #resultModal h2{margin:0; font-family:var(--font-title); font-weight:900; font-size:clamp(18px,2.4vw,26px); text-align:center}
    #resultScore{ text-align:center }
    .grid2{display:grid; grid-template-columns:1fr; gap:12px}
    @media (min-width: 860px){ .grid2{grid-template-columns: 1.1fr .9fr;} }

    .panelCard{
      border:1px solid var(--surface-border);
      background:linear-gradient(180deg, rgba(255,255,255,.04), rgba(255,255,255,.02));
      border-radius:14px;
      padding:12px;
    }
    .panelCard h3{margin:0 0 10px 0; font-family:var(--font-title); font-size:16px; letter-spacing:.2px}

    .barRow{display:grid; grid-template-columns: 1fr 90px; gap:10px; align-items:center; padding:7px 0; border-top:1px dashed rgba(255,255,255,.12)}
    .barRow:first-child{border-top:0}
    .barLabel{font-size:13px; color:var(--muted); margin-bottom:6px}
    .barWrap{height:10px; border-radius:999px; background:rgba(255,255,255,.10); overflow:hidden}
    .barFill{height:100%; width:0%; background:linear-gradient(90deg, var(--accent), var(--accent2)); transition:width .6s ease}
    .barPct{font-family:var(--font-title); font-weight:900; text-align:right}

    .miniLegend{display:flex; gap:10px; flex-wrap:wrap; font-size:12px; color:var(--muted)}
    .dot{width:10px;height:10px;border-radius:999px;display:inline-block; background:linear-gradient(90deg, var(--accent), var(--accent2)); margin-right:6px; vertical-align:middle}
    .resultActions{display:flex; justify-content:flex-end; gap:10px; flex-wrap:wrap}

    /* --- Welcome screen --- */
    .welcomeBox{
      height:100%;
      display:flex;
      position:relative;
      flex-direction:column;
      align-items:center;
      justify-content:center;
      text-align:center;
      padding:10px 14px;
      padding-bottom:90px;
      gap:14px;
    }
    .welcomeBox h2{
      margin:0;
      font-family:var(--font-title);
      font-weight:900;
      font-size:clamp(26px,4vw,38px);
      letter-spacing:.2px;
    }
    .welcomeBox .wtext{
      max-width:760px;
      font-size:clamp(14px,2vw,18px);
      line-height:1.5;
      color:var(--muted);
      text-align:justify;
    }
    .welcomeBox .wcredit{
      position:absolute;
      left:50%;
      bottom:12px;
      transform:translateX(-50%);
      text-align:center;
      width:100%;
      font-size:clamp(13px,1.6vw,16px);
      color:var(--muted);
    }
    .welcomeBox .wcredit a{
      color:inherit;
      text-decoration:underline;
    }
    .welcomeBox .wcredit a:hover{ text-decoration:underline; }
    .welcomeBox .wcta{
      margin-top:10px;
      margin-bottom:26px; /* keep distance from footer */
      display:flex;
      justify-content:center;
      width:100%;
    }

    /* Welcome footer center credit aligned with footer labels */
    #welcomeCreditFooter{
      position:absolute;
      left:50%;
      top:50%;
      transform:translate(-50%,-50%);
      display:none;
      align-items:center;
      gap:6px;
      color:var(--muted);
      font-size:12px;
      white-space:nowrap;
      pointer-events:auto;
    }
    #welcomeCreditFooter a{
      color:inherit;
      text-decoration:underline;
    }
  </style>
</head>
<body>
  <header>
    <div class="wrap">
      <div class="title">
        <h1>Quiz d‚Äôauto-√©valuation ‚Äî Comp√©tences cl√©s ICF (68 questions)</h1>
      </div>
      <div class="meter">
        <div class="badge">‚úÖ Correctes : <b id="good">0</b></div>
        <div class="badge">‚ùå Incorrectes : <b id="bad">0</b></div>
        <div class="badge">üìä Pourcentage : <b id="pct">0%</b></div>
        <div class="progress"><span id="prog"></span></div>
      </div>
    </div>
  </header>

  <main>
    <div class="stage">
      <article class="card">
        <div>
          <div class="q-head">
            <div class="q-index" id="qIndex">Question 1 sur 68</div>
            <div class="pill" id="answered">0 / 68 r√©ponses</div>
          </div>
          <div class="question" id="questionText">...</div>
        </div>
        <div class="opts" id="options"></div>
        <div class="nav"><button class="action" id="nextBtn" disabled>SUIVANT</button></div>
      </article>
    </div>
  </main>

  <footer>
    <div class="wrap footbar">
      <div class="left"><span class="pill">Objectif de r√©ussite : <b>‚â• 80%</b></span></div>
      <button class="action" id="finishBtn">Terminer le test</button>
    </div>
  </footer>

  <section class="modal" id="resultModal">
    <div class="panel">
      <h2 id="resultTitle"></h2>
      <div id="resultScore" style="font-size:16px; opacity:.9;"></div>

      <div class="grid2">
        <div class="panelCard">
          <h3>üìä Graphique par comp√©tence cl√©</h3>
          <div class="miniLegend"><span><span class="dot"></span>% de r√©ponses correctes par comp√©tence</span></div>
          <div id="coreBars"></div>
        </div>

        <div class="panelCard">
          <h3>üìå R√©capitulatif</h3>
          <div id="summaryBox" style="font-size:14px; line-height:1.5; color:var(--muted)"></div>
        </div>
      </div>

      <div class="resultActions">
        <button class="action ghost" id="restartBtn">Recommencer</button>
        <button class="action" id="closeBtn">Terminer</button>
      </div>
    </div>
  </section>

  <script>
  (function(){
    // --- Dataset (FR) : fourni par toi (la logique du quiz repose sur ces libell√©s exacts) ---
    const CORE=[
      "Fait preuve d‚Äô√©thique dans sa pratique",
      "Incarne un √©tat d‚Äôesprit Coaching",
      "D√©finit et maintient les contrats",
      "D√©veloppe un espace de confiance et de s√©curit√©",
      "Reste en pr√©sence",
      "√âcoute activement",
      "Suscite des prises de conscience",
      "Facilite la croissance du client"
    ];

    const SUB=[
      // 1. Fait preuve d‚Äô√©thique dans sa pratique (7)
      ["Fait preuve d'int√©grit√© personnelle et d'honn√™tet√© dans ses relations avec les clients, les commanditaires et les parties prenantes","Fait preuve d‚Äô√©thique dans sa pratique"],
      ["Prend en compte l'identit√©, l‚Äôenvironnement, les exp√©riences, les valeurs et les croyances des clients","Fait preuve d‚Äô√©thique dans sa pratique"],
      ["Utilise un langage appropri√© et respectueux avec les clients, les commanditaires et les parties prenantes","Fait preuve d‚Äô√©thique dans sa pratique"],
      ["Respecte le code de d√©ontologie et d√©fend les valeurs fondamentales de l'ICF","Fait preuve d‚Äô√©thique dans sa pratique"],
      ["Pr√©serve la confidentialit√© des informations sur les clients conform√©ment aux contrats avec les parties prenantes et les lois en vigueur","Fait preuve d‚Äô√©thique dans sa pratique"],
      ["Pr√©serve la distinction entre le coaching, le conseil, la psychoth√©rapie et les autres professions d‚Äôaccompagnement","Fait preuve d‚Äô√©thique dans sa pratique"],
      ["Oriente les clients vers d'autres professionnels de l‚Äôaccompagnement si besoin","Fait preuve d‚Äô√©thique dans sa pratique"],

      // 2. Incarne un √©tat d‚Äôesprit Coaching (10)
      ["Reconna√Æt que les clients sont responsables de leurs propres choix","Incarne un √©tat d‚Äôesprit Coaching"],
      ["En tant que coach, s‚Äôengage dans un processus d‚Äôapprentissage et de d√©veloppement continu, en se tenant notamment au courant de l'√©volution des bonnes pratiques et de l‚Äôutilisation des technologies","Incarne un √©tat d‚Äôesprit Coaching"],
      ["D√©veloppe une pratique r√©flexive continue pour am√©liorer sa pratique de coach","Incarne un √©tat d‚Äôesprit Coaching"],
      ["Reste attentif et sensible √† l'impact des biais, du contexte et de la culture, sur soi et sur les autres","Incarne un √©tat d‚Äôesprit Coaching"],
      ["Utilise sa conscience de soi ainsi que son intuition au service des clients","Incarne un √©tat d‚Äôesprit Coaching"],
      ["D√©veloppe et garde sa capacit√© √† g√©rer ses √©motions","Incarne un √©tat d‚Äôesprit Coaching"],
      ["Entretient un √©tat de bien-√™tre mental, physique et √©motionnel avant, pendant et apr√®s chacune des s√©ances","Incarne un √©tat d‚Äôesprit Coaching"],
      ["Recherche l'aide de ressources ext√©rieures lorsque n√©cessaire","Incarne un √©tat d‚Äôesprit Coaching"],
      ["Cultive l‚Äôouverture et la curiosit√© envers soi-m√™me, le client et le processus de coaching","Incarne un √©tat d‚Äôesprit Coaching"],
      ["Reste attentif √† l‚Äôinfluence de ses r√©flexions et de ses comportements sur le client et sur les autres","Incarne un √©tat d‚Äôesprit Coaching"],

      // 3. D√©finit et maintient les contrats (12)
      ["Pr√©sente sa philosophie du coaching et explique clairement, √† ses clients potentiels et aux parties prenantes, ce qu'est le coaching et ce que ce n‚Äôest","D√©finit et maintient les contrats"],
      ["Aboutit √† un accord sur ce qui est ou n‚Äôest pas appropri√© dans la relation de coaching, sur ce qui est ou n‚Äôest pas inclus dans le contrat propos√©, ainsi que sur les responsabilit√©s du client et des parties prenantes, avec notamment le fait de s‚Äôengager √† poursuivre l'atteinte des objectifs du coaching","D√©finit et maintient les contrats"],
      ["Aboutit √† un accord sur les lignes directrices et les param√®tres sp√©cifiques de la relation de coaching tels que la logistique, les tarifs, le calendrier, la dur√©e, la r√©siliation, la confidentialit√© et la participation d‚Äôautres acteurs","D√©finit et maintient les contrats"],
      ["Collabore avec le client et les parties prenantes pour d√©finir le plan global de coaching et les objectifs","D√©finit et maintient les contrats"],
      ["Collabore avec le client pour s‚Äôassurer de l‚Äôaffinit√© entre le client et le coach","D√©finit et maintient les contrats"],
      ["Collabore avec le client pour identifier ou reconfirmer ce que celui-ci veut accomplir pendant la s√©ance","D√©finit et maintient les contrats"],
      ["Collabore avec le client pour d√©finir ce que celui-ci estime devoir aborder ou r√©soudre pour accomplir ce qu‚Äôil souhaite durant la s√©ance","D√©finit et maintient les contrats"],
      ["Collabore avec le client pour d√©finir ou reconfirmer les indicateurs de succ√®s du cycle de coaching ou de la s√©ance","D√©finit et maintient les contrats"],
      ["Collabore avec le client pour g√©rer le temps et l'objectif de la s√©ance","D√©finit et maintient les contrats"],
      ["Poursuit le coaching vers le r√©sultat souhait√© par le client, sauf indication contraire du client","D√©finit et maintient les contrats"],
      ["Collabore avec le client pour mettre un terme √† la relation de coaching d‚Äôune mani√®re qui respecte √† la fois le client et l‚Äôexp√©rience du coaching","D√©finit et maintient les contrats"],
      ["Quand cela se r√©v√®le n√©cessaire, r√©vise le contrat de coaching pour s‚Äôassurer que l‚Äôapproche de coaching r√©pond bien aux besoins du client","D√©finit et maintient les contrats"],

      // 4. D√©veloppe un espace de confiance et de s√©curit√© (6)
      ["Cherche √† comprendre le client dans son contexte, pouvant inclure son identit√©, son environnement, ses exp√©riences, ses valeurs et ses croyances","D√©veloppe un espace de confiance et de s√©curit√©"],
      ["Fait preuve de respect pour la personne dans son int√©gralit√©, ses perceptions, son style, son langage et adapte son coaching en cons√©quence","D√©veloppe un espace de confiance et de s√©curit√©"],
      ["Reconna√Æt et respecte la singularit√© des talents, des id√©es et du travail du client dans le processus de coaching","D√©veloppe un espace de confiance et de s√©curit√©"],
      ["Fait preuve de soutien, d'empathie et d‚Äôattention envers le client","D√©veloppe un espace de confiance et de s√©curit√©"],
      ["Reconna√Æt et favorise l‚Äôexpression des sentiments, des perceptions, des pr√©occupations, des croyances et des suggestions du client","D√©veloppe un espace de confiance et de s√©curit√©"],
      ["Fait preuve d‚Äôouverture et de transparence pour montrer sa vuln√©rabilit√© et construire une relation de confiance avec le client","D√©veloppe un espace de confiance et de s√©curit√©"],

      // 5. Reste en pr√©sence (7)
      ["Reste concentr√©, attentif, empathique et r√©ceptif envers le client","Reste en pr√©sence"],
      ["Fait preuve de curiosit√© pendant le processus de coaching","Reste en pr√©sence"],
      ["Reste attentif √† ce qui se produit pour soi et pour le client dans le moment pr√©sent","Reste en pr√©sence"],
      ["G√®re ses √©motions pour rester pr√©sent avec le client","Reste en pr√©sence"],
      ["Fait preuve de confiance en travaillant avec les √©motions fortes du client pendant le processus de coaching","Reste en pr√©sence"],
      ["Est √† l'aise pour travailler en faisant face √† l'inconnu","Reste en pr√©sence"],
      ["Cr√©e ou permet un espace pour le silence, la pause ou la r√©flexion","Reste en pr√©sence"],

      // 6. √âcoute activement (6)
      ["Consid√®re le contexte du client, son identit√©, son environnement, ses exp√©riences, ses valeurs et ses croyances afin de mieux comprendre ce que le client communique","√âcoute activement"],
      ["Refl√®te ou r√©sume ce que le client communique pour s'assurer de la clart√© et de la compr√©hension","√âcoute activement"],
      ["Identifie et explore ce qu'il y a au-del√† de ce que le client communique","√âcoute activement"],
      ["Remarque, reconna√Æt et explore les √©motions, les changements d‚Äô√©nergie, les signaux non verbaux ou les autres comportements du client","√âcoute activement"],
      ["Prend en compte les mots, le ton de la voix et le langage corporel du client afin de d√©terminer la pleine signification de ce qu'il communique","√âcoute activement"],
      ["Remarque les tendances dans les comportements et les √©motions du client au cours des s√©ances pour discerner les sujets et les sch√©mas r√©currents","√âcoute activement"],

      // 7. Suscite des prises de conscience (11)
      ["Prend en compte l'exp√©rience du client pour d√©cider de ce qui pourrait √™tre le plus utile","Suscite des prises de conscience"],
      ["Challenge le client pour favoriser prise de conscience ou d√©couverte","Suscite des prises de conscience"],
      ["Pose des questions sur le client, sa fa√ßon de penser, ses valeurs, ses besoins, ses d√©sirs et ses croyances","Suscite des prises de conscience"],
      ["Pose des questions qui aident le client √† explorer au-del√† de la pens√©e habituelle","Suscite des prises de conscience"],
      ["Invite le client √† partager davantage son exp√©rience dans l'instant","Suscite des prises de conscience"],
      ["Remarque ce qui fonctionne pour am√©liorer les progr√®s du client","Suscite des prises de conscience"],
      ["Adapte l'approche de coaching en r√©ponse aux besoins du client","Suscite des prises de conscience"],
      ["Aide le client √† identifier les facteurs qui influencent les sch√©mas pr√©sents et futurs de comportement, de pens√©e ou d‚Äô√©motion","Suscite des prises de conscience"],
      ["Invite le client √† d√©velopper des id√©es sur la fa√ßon dont il peut aller de l‚Äôavant et sur ce qu'il souhaite ou est en capacit√© de faire","Suscite des prises de conscience"],
      ["Aide le client en reformulant les perspectives","Suscite des prises de conscience"],
      ["Sans attachement, partage des observations, des connaissances et des ressentis qui seraient susceptibles de cr√©er de nouvelles prises de conscience pour le client","Suscite des prises de conscience"],

      // 8. Facilite la croissance du client (9)
      ["Travaille avec le client pour int√©grer de nouvelles prises de conscience, des d√©couvertes ou des apprentissages dans sa vision du monde et ses comportements","Facilite la croissance du client"],
      ["Collabore avec le client pour concevoir des objectifs, des actions et des mesures de responsabilisation qui int√®grent et d√©veloppent de nouveaux apprentissages","Facilite la croissance du client"],
      ["Reconna√Æt et soutient l'autonomie du client dans la conception des objectifs, des actions et des m√©thodes de responsabilisation","Facilite la croissance du client"],
      ["Aide le client √† identifier les r√©sultats ou les apprentissages potentiels des √©tapes d'action identifi√©es","Facilite la croissance du client"],
      ["Invite le client √† consid√©rer la mani√®re d'aller de l'avant, en int√©grant les ressources, le soutien et les obstacles potentiels","Facilite la croissance du client"],
      ["Collabore avec le client pour r√©sumer les apprentissages et les d√©couvertes pendant ou entre les s√©ances","Facilite la croissance du client"],
      ["Collabore avec le client pour favoriser l'int√©gration des apprentissages et soutenir ses progr√®s tout au long du cycle de coaching","Facilite la croissance du client"],
      ["Reconna√Æt les progr√®s et les r√©ussites du client","Facilite la croissance du client"],
      ["Collabore avec le client pour terminer la s√©ance","Facilite la croissance du client"]
    ];

    const $=id=>document.getElementById(id);
    const qIndex=$("qIndex"), qText=$("questionText"), optsBox=$("options"),
          nextBtn=$("nextBtn"), goodEl=$("good"), badEl=$("bad"),
          pctEl=$("pct"), progEl=$("prog"), ansEl=$("answered"),
          finishBtn=$("finishBtn"), modal=$("resultModal"),
          coreBars=$("coreBars"), summaryBox=$("summaryBox"),
          restartBtn=$("restartBtn"), closeBtn=$("closeBtn");

    // --- Welcome screen state ---
    let welcome=true;

    function renderWelcome(){
      finishBtn.disabled=true;

      nextBtn.style.display="none";
      finishBtn.style.display="none";
      const wcf = document.getElementById("welcomeCreditFooter");
      if(wcf) wcf.style.display="inline-flex";

      qIndex.textContent="";
      qText.innerHTML = `
        <div class="welcomeBox">
          <h2>Bienvenue !</h2>
          <div class="wtext">
            <div>Dans ce questionnaire d‚Äôauto-√©valuation des Comp√©tences cl√©s ICF, tu devras r√©pondre √† 68 questions.</div>
            <div>Pour chaque question, choisis la Comp√©tence cl√© √† laquelle appartient la sous-comp√©tence mentionn√©e.</div>
            <div>Le test est r√©ussi avec au moins 80% de bonnes r√©ponses.</div>
            <div>√Ä la fin, tu pourras consulter un r√©capitulatif des r√©ponses et de tes r√©sultats.</div>
          </div>

          <div class="wcta">
            <button class="action" id="startBtn">COMMENCER LE TEST</button>
          </div>

          <div class="wcredit">
            <span>Cr√©√© par Tito Bertasi</span>
            <span> (</span>
            <a href="https://www.linkedin.com/in/titobertasi1980/" target="_blank" rel="noopener noreferrer">
              Visiter le profil LinkedIn
            </a>
            <span>)</span>
          </div>
        </div>
      `;
      optsBox.innerHTML="";

      const startBtnEl = document.getElementById("startBtn");
      if(startBtnEl){
        startBtnEl.addEventListener("click", ()=>{
          welcome=false;
          nextBtn.style.display="";
          finishBtn.style.display="";
          const wcf2 = document.getElementById("welcomeCreditFooter");
          if(wcf2) wcf2.style.display="none";
          nextBtn.textContent="SUIVANT";
          renderQuestion();
        }, { once:true });
      }
    }

    const shuffle=(arr)=>{const a=arr.slice();for(let i=a.length-1;i>0;i--){const j=(Math.random()*(i+1))|0;[a[i],a[j]]=[a[j],a[i]];}return a;};

    function makeQuestions(){
      const pool=shuffle(SUB.slice());
      return pool.map(([sub,core])=>{
        const options=shuffle(CORE.slice());
        return { sub, core, options, correct: options.indexOf(core) };
      });
    }

    let QUESTIONS=makeQuestions(),idx=0,good=0,bad=0,answered=0,locked=false;

    let coreTotals={}, coreGoods={};
    function initCoreStats(){
      coreTotals={}; coreGoods={};
      CORE.forEach(c=>{coreTotals[c]=0; coreGoods[c]=0;});
    }
    initCoreStats();

    function updateHUD(){
      const pct=answered?Math.round((good/answered)*100):0;
      goodEl.textContent=good; badEl.textContent=bad; pctEl.textContent=pct+"%";
      ansEl.textContent=`${answered} / ${QUESTIONS.length} r√©ponses`;
      progEl.style.width=Math.round((answered/QUESTIONS.length)*100)+"%";
    }

    function renderQuestion(){
      if(welcome){ renderWelcome(); return; }
      const wcf3 = document.getElementById("welcomeCreditFooter");
      if(wcf3) wcf3.style.display="none";
      nextBtn.style.display="";
      finishBtn.style.display="";
      finishBtn.disabled=false;

      locked=false; nextBtn.disabled=true; optsBox.innerHTML="";
      const q=QUESTIONS[idx];
      qIndex.textContent=`Question ${idx+1} sur ${QUESTIONS.length}`;
      qText.innerHTML=`√Ä quelle comp√©tence cl√© appartient la sous-comp√©tence suivante ?<br><b>"${q.sub}"</b>`;

      q.options.forEach((opt,i)=>{
        const b=document.createElement("button"); b.className="btn"; b.dataset.i=i; b.textContent=opt;
        b.addEventListener("click",()=>{
          if(locked)return; locked=true;
          coreTotals[q.core]++;

          const all=optsBox.querySelectorAll(".btn"); all.forEach(x=>x.classList.add("disabled"));
          if(i===q.correct){
            b.classList.add("correct");
            good++;
            coreGoods[q.core]++;
          }else{
            b.classList.add("wrong"); bad++;
            all.forEach(x=>{ if(Number(x.dataset.i)===q.correct) x.classList.add("correct"); });
          }

          answered++; updateHUD(); nextBtn.disabled=false;
          if(idx===QUESTIONS.length-1) nextBtn.textContent="VOIR LE R√âSULTAT";
        });
        optsBox.appendChild(b);
      });
    }

    function buildBars(){
      coreBars.innerHTML="";
      CORE.forEach(core=>{
        const tot=coreTotals[core]||0;
        const ok=coreGoods[core]||0;
        const pct=tot?Math.round((ok/tot)*100):0;

        const row=document.createElement("div");
        row.className="barRow";

        const left=document.createElement("div");
        const label=document.createElement("div");
        label.className="barLabel";
        label.textContent=core;

        const wrap=document.createElement("div");
        wrap.className="barWrap";

        const fill=document.createElement("div");
        fill.className="barFill";
        fill.style.width=pct+"%";

        wrap.appendChild(fill);
        left.appendChild(label);
        left.appendChild(wrap);

        const right=document.createElement("div");
        right.className="barPct";
        right.textContent=pct+"%";

        row.appendChild(left);
        row.appendChild(right);
        coreBars.appendChild(row);
      });
    }

    function finish(){
      const total=QUESTIONS.length;
      const pct=Math.round((good/total)*100);
      const title=$("resultTitle"); const score=$("resultScore");
      const passed=(pct>=80); const emoji=passed?"üòé":"üò¢";

      title.textContent = passed
        ? `${emoji} BRAVO, VOUS AVEZ R√âUSSI LE TEST AVEC UN SCORE DE ${pct}% ${emoji}`
        : `${emoji} R√âESSAYEZ : VOTRE SCORE EST ${pct}% ${emoji}`;

      score.textContent = `Correctes : ${good} ‚Ä¢ Incorrectes : ${bad} ‚Ä¢ Total : ${total}`;

      const stats = CORE
        .map(c => {
          const tot = coreTotals[c] || 0;
          const ok  = coreGoods[c] || 0;
          const pct = tot ? (ok / tot * 100) : 0;
          return { c, pct };
        })
        .sort((a,b) => b.pct - a.pct);

      const strengths = stats.filter(x => x.pct >= 80).sort((a,b) => b.pct - a.pct);
      const toImprove = stats.filter(x => x.pct < 80).sort((a,b) => a.pct - b.pct);

      const strengthsHTML = strengths.length
        ? `<ul style="margin:6px 0 0 18px; padding:0; color:var(--muted)">
            ${strengths.map(x => `<li><b>${x.c}</b> (${Math.round(x.pct)}%)</li>`).join("")}
           </ul>`
        : `<div style="margin-top:6px; color:var(--muted)">Aucune comp√©tence n‚Äôest ‚â• 80% (pour le moment).</div>`;

      const improveHTML = toImprove.length
        ? `<ul style="margin:6px 0 0 18px; padding:0; color:var(--muted)">
            ${toImprove.map(x => `<li><b>${x.c}</b> (${Math.round(x.pct)}%)</li>`).join("")}
           </ul>`
        : `<div style="margin-top:6px; color:var(--muted)"><b>Toutes</b> les comp√©tences sont ‚â• 80% ‚úÖ</div>`;

      summaryBox.innerHTML = `
        <div><b>Objectif :</b> ‚â• 80% ‚Äî <b>${passed ? "atteint ‚úÖ" : "non atteint ‚ùå"}</b></div>

        <div style="margin-top:10px"><b>Points forts (‚â• 80%) :</b>${strengthsHTML}</div>

        <div style="margin-top:10px"><b>√Ä renforcer (sous 80%) :</b>${improveHTML}</div>

        <div style="margin-top:10px">Conseil : refais le quiz jusqu‚Äô√† obtenir ‚â• 80% de fa√ßon stable sur toutes les comp√©tences.</div>
      `;

      buildBars();
      modal.classList.add('show');
    }

    function restart(){
      welcome=true;
      QUESTIONS=makeQuestions();
      idx=0; good=0; bad=0; answered=0; locked=false;
      initCoreStats();
      nextBtn.textContent="SUIVANT";
      modal.classList.remove('show');
      updateHUD(); renderQuestion();
    }

    nextBtn.addEventListener("click",()=>{
      if(welcome){ return; }
      if(idx<QUESTIONS.length-1){ idx++; renderQuestion(); }
      else finish();
    });
    finishBtn.addEventListener("click",finish);
    restartBtn.addEventListener("click",restart);
    closeBtn.addEventListener("click",()=>{
      try { window.close(); } catch(e) {}
      window.location.href = "about:blank";
    });

    updateHUD(); renderQuestion();
  })();
  </script>
</body>
</html>
